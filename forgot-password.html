<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>E-Clientes - Recuperar Contraseña</title>
  <link rel="stylesheet" href="/css/login.css"> <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Estilos adicionales para mensajes (si no están en login.css) */
    .message-area {
      margin-top: 15px;
      padding: 10px;
      border-radius: 4px;
      font-size: 0.9em;
      text-align: center;
    }
    .success-message {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .error-message {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .login-button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    .login-button .material-icons { /* Para alinear el icono con el texto en el botón */
        vertical-align: middle;
        margin-right: 5px;
    }
  </style>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script type="text/javascript">
    (function() {
      // Reemplaza con tu Public Key de EmailJS
      emailjs.init({ publicKey: "YOUR_PUBLIC_KEY" });
    })();
  </script>
</head>
<body>
  <div class="login-container">
    <div class="login-card">
      <div class="login-header">
        <div class="logo">
          <span class="material-icons">lock_reset</span>
        </div>
        <h1>E-Clientes</h1>
        <p>Recuperar Contraseña</p>
      </div>

      <form id="forgotPasswordForm" class="login-form">
        <p class="form-instruction">
          Ingresa tu dirección de correo electrónico asociada con tu cuenta. Te enviaremos un correo con instrucciones.
        </p>

        <div class="form-group">
          <label for="email">
            <span class="material-icons">email</span>
            Correo Electrónico
          </label>
          <input
            type="email"
            id="email"
            name="email"
            placeholder="Ingrese su correo electrónico"
            required
            autocomplete="email"
          >
        </div>

        <button type="submit" class="login-button" id="submitButton">
          <span class="material-icons">send</span>
          Enviar Instrucciones
        </button>

        <div id="recoveryMessage" class="message-area"></div>
      </form>

      <div class="login-footer">
        <p><a href="login.html">Volver a Iniciar Sesión</a></p> </div>
    </div>

    <div class="login-info">
      <h2>Recuperación de Cuenta</h2>
      <p>Sigue las instrucciones para recuperar el acceso a tu cuenta de E-Clientes.</p>
      <ul>
        <li><span class="material-icons">check_circle</span> Ingresa tu correo registrado.</li>
        <li><span class="material-icons">check_circle</span> Revisa tu bandeja de entrada para las instrucciones.</li>
      </ul>
    </div>
  </div>

  <script>
    const forgotPasswordForm = document.getElementById('forgotPasswordForm');
    const recoveryMessage = document.getElementById('recoveryMessage');
    const submitButton = document.getElementById('submitButton');

    // Reemplaza con tus IDs de EmailJS
    // Debes obtener estos de tu cuenta de EmailJS
    const SERVICE_ID = "YOUR_SERVICE_ID"; // Ejemplo: 'service_xxxxxxx'
    const TEMPLATE_ID = "YOUR_TEMPLATE_ID"; // Ejemplo: 'template_xxxxxxx' (el ID de esta plantilla "Password Reset")

    // Inicializa EmailJS con tu Public Key (ya lo tienes en el <head>, solo asegúrate que es la correcta)
    // emailjs.init({ publicKey: "YOUR_PUBLIC_KEY" });

    if (forgotPasswordForm) {
      forgotPasswordForm.addEventListener('submit', function(event) {
        event.preventDefault();
        recoveryMessage.textContent = '';
        recoveryMessage.className = 'message-area';
        submitButton.disabled = true;
        submitButton.innerHTML = '<span class="material-icons">hourglass_top</span> Enviando...';

        const userEmail = document.getElementById('email').value;

        if (!userEmail) {
          recoveryMessage.textContent = 'Por favor, ingrese su correo electrónico.';
          recoveryMessage.classList.add('error-message');
          submitButton.disabled = false;
          submitButton.innerHTML = '<span class="material-icons">send</span> Enviar Instrucciones';
          return;
        }

        // Parámetros para tu plantilla de EmailJS
        // ASEGÚRATE que estos nombres de parámetros coinciden EXACTAMENTE
        // con las variables {{variable}} que usas en tu plantilla de EmailJS.
        const templateParams = {
          to_email: userEmail, // EmailJS usará esto para el campo "To Email" si la plantilla está configurada para ello.
          // TU PLANTILLA USA {{nombre}} para "From Name", así que debemos proveerlo.
          // Puedes decidir qué poner aquí, por ejemplo, el nombre de tu aplicación.
          nombre: "Equipo E-Clientes", // O el nombre que desees que aparezca como remitente.

          // TU PLANTILLA USA {{link}} para el enlace de reseteo.
          // IMPORTANTE: Este es un ENLACE PLACEHOLDER.
          // Un sistema seguro de reseteo necesita un token único generado por un backend.
          link: "https://tu-sitio.com/nueva-pagina-para-resetear-clave", // CAMBIA ESTO por el enlace real y funcional

          // Opcional: si quieres que el "Reply To" sea dinámico.
          // Si tu plantilla ya tiene un valor fijo para "Reply To" y no usa una variable, no necesitas enviarlo.
          // reply_to: userEmail,

          // Para los campos Cc y Bcc:
          // Si siempre son los mismos, configúralos directamente en la plantilla de EmailJS.
          // Si necesitas que sean dinámicos y tu plantilla usa variables para ellos (ej. {{cc_email}}, {{bcc_email}}),
          // entonces añádelos aquí:
          // cc_email: "tu_cc_email@ejemplo.com",
          // bcc_email: "tu_bcc_email@ejemplo.com"
        };

        // Asegúrate que tu TEMPLATE_ID es el correcto para la plantilla "Password Reset"
        emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams)
          .then(function(response) {
            console.log('EmailJS SUCCESS!', response.status, response.text);
            recoveryMessage.textContent = 'Se han enviado las instrucciones a tu correo electrónico. Por favor, revisa tu bandeja de entrada (y spam).';
            recoveryMessage.classList.add('success-message');
            forgotPasswordForm.reset();
          }, function(error) {
            console.error('EmailJS FAILED...', error);
            // Intenta mostrar un mensaje de error más específico si EmailJS lo proporciona
            let errorMessage = 'Error al enviar el correo. Por favor, inténtalo más tarde o contacta al administrador.';
            if (error && error.text) {
                errorMessage += ` (Detalle: ${error.text})`;
            } else if (error && error.status) {
                errorMessage += ` (Código: ${error.status})`;
            }
            recoveryMessage.textContent = errorMessage;
            recoveryMessage.classList.add('error-message');
          })
          .finally(function() {
            submitButton.disabled = false;
            submitButton.innerHTML = '<span class="material-icons">send</span> Enviar Instrucciones';
          });
      });
    }     
  </script>
</body>
</html>