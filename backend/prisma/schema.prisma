generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model BP_01_USUARIO {
  nId01Usuario            Int                       @id @default(autoincrement())
  sNombre                 String
  sApellidoPaterno        String
  sApellidoMaterno        String
  sUsuario                String                    @unique(map: "BP_01_USUARIO_sUsuario_key")
  sEmail                  String                    @unique(map: "BP_01_USUARIO_sEmail_key")
  sPassword               String
  bActivo                 Boolean                   @default(false)
  dFechaCreacion          DateTime                  @default(now())
  dFechaActualizacion     DateTime?
  sUsuarioImg             String?
  dFechaUltimoCambioPass  DateTime                  @default(now())
  nIdCliente              Int?
  perfilesUsuario         BP_04_PERFIL_USUARIO[]    @relation("UsuarioPerfiles")
  bp_06_registro_consulta bp_06_registro_consulta[]
  logsAutenticacion       BP_07_LOG_AUTENTICACION[] @relation("UsuarioLogsAuth")
  sesionesActivas         BP_08_SESION_ACTIVA[]     @relation("UsuarioSesiones")

  @@map("bp_01_usuario")
}

model BP_02_PERFIL {
  nId02Perfil         Int                    @id @default(autoincrement())
  sNombre             String                 @unique(map: "BP_02_PERFIL_sNombre_key")
  sDescripcion        String
  dFechaCreacion      DateTime               @default(now())
  dFechaActualizacion DateTime?
  perfilesUsuario     BP_04_PERFIL_USUARIO[] @relation("PerfilUsuarios")
  perfilesPermiso     BP_05_PERFIL_PERMISO[] @relation("PerfilPermisos")

  @@map("bp_02_perfil")
}

model BP_03_PERMISO {
  nId03Permiso        Int                    @id @default(autoincrement())
  sNombre             String                 @unique(map: "BP_03_PERMISO_sNombre_key")
  sDescripcion        String
  dFechaCreacion      DateTime               @default(now())
  dFechaActualizacion DateTime?
  perfilesPermiso     BP_05_PERFIL_PERMISO[] @relation("PermisoPerfiles")

  @@map("bp_03_permiso")
}

model BP_04_PERFIL_USUARIO {
  nId04PerfilUsuario  Int           @id @default(autoincrement())
  nId01Usuario        Int
  nId02Perfil         Int
  dFechaCreacion      DateTime      @default(now())
  dFechaActualizacion DateTime?
  usuario             BP_01_USUARIO @relation("UsuarioPerfiles", fields: [nId01Usuario], references: [nId01Usuario], map: "BP_04_PERFIL_USUARIO_nId01Usuario_fkey")
  perfil              BP_02_PERFIL  @relation("PerfilUsuarios", fields: [nId02Perfil], references: [nId02Perfil], map: "BP_04_PERFIL_USUARIO_nId02Perfil_fkey")

  @@index([nId01Usuario], map: "BP_04_PERFIL_USUARIO_nId01Usuario_fkey")
  @@index([nId02Perfil], map: "BP_04_PERFIL_USUARIO_nId02Perfil_fkey")
  @@map("bp_04_perfil_usuario")
}

model BP_05_PERFIL_PERMISO {
  nId05PerfilPermiso  Int           @id @default(autoincrement())
  nId03Permiso        Int
  nId02Perfil         Int
  nLeer               Boolean       @default(false)
  nCrear              Boolean       @default(false)
  nEditar             Boolean       @default(false)
  nBorrar             Boolean       @default(false)
  dFechaCreacion      DateTime      @default(now())
  dFechaActualizacion DateTime?
  perfil              BP_02_PERFIL  @relation("PerfilPermisos", fields: [nId02Perfil], references: [nId02Perfil], map: "BP_05_PERFIL_PERMISO_nId02Perfil_fkey")
  permiso             BP_03_PERMISO @relation("PermisoPerfiles", fields: [nId03Permiso], references: [nId03Permiso], map: "BP_05_PERFIL_PERMISO_nId03Permiso_fkey")

  @@index([nId02Perfil], map: "BP_05_PERFIL_PERMISO_nId02Perfil_fkey")
  @@index([nId03Permiso], map: "BP_05_PERFIL_PERMISO_nId03Permiso_fkey")
  @@map("bp_05_perfil_permiso")
}

model bp_06_registro_consulta {
  nId06RegistroConsulta Int           @id @default(autoincrement())
  nId01Usuario          Int
  sFolioReferencia      String        @db.VarChar(255)
  sDetalleConsulta      String?       @db.Text
  sTipoConsulta         String        @db.VarChar(50)
  bExito                Boolean?      @default(true)
  sError                String?       @db.Text
  dFechaConsulta        DateTime?     @default(now()) @db.DateTime(0)
  sIpUsuario            String?       @db.VarChar(50)
  bp_01_usuario         BP_01_USUARIO @relation(fields: [nId01Usuario], references: [nId01Usuario], onDelete: NoAction, onUpdate: NoAction, map: "bp_06_registro_consulta_ibfk_1")

  @@index([dFechaConsulta], map: "idx_registro_consulta_fecha")
  @@index([sTipoConsulta], map: "idx_registro_consulta_tipo")
  @@index([nId01Usuario], map: "idx_registro_consulta_usuario")
}

model BP_07_LOG_AUTENTICACION {
  nId07LogAuth  Int           @id @default(autoincrement())
  nId01Usuario  Int
  sTipoAccion   String        @db.VarChar(50)
  dFechaHora    DateTime      @default(now()) @db.DateTime(0)
  sIpUsuario    String?       @db.VarChar(50)
  sUserAgent    String?       @db.Text
  sDispositivo  String?       @db.VarChar(100)
  sUbicacion    String?       @db.VarChar(255)
  bExitoso      Boolean       @default(true)
  sDetalleError String?       @db.Text
  sTokenSesion  String?       @db.VarChar(255)
  usuario       BP_01_USUARIO @relation("UsuarioLogsAuth", fields: [nId01Usuario], references: [nId01Usuario], onDelete: NoAction, onUpdate: NoAction, map: "BP_07_LOG_AUTENTICACION_ibfk_1")

  @@index([nId01Usuario], map: "idx_log_auth_usuario")
  @@index([dFechaHora], map: "idx_log_auth_fecha")
  @@index([sTipoAccion], map: "idx_log_auth_tipo")
  @@map("bp_07_log_autenticacion")
}

model BP_08_SESION_ACTIVA {
  nId08Sesion           Int           @id @default(autoincrement())
  nId01Usuario          Int
  sTokenSesion          String        @unique(map: "sTokenSesion") @db.VarChar(255)
  dFechaInicio          DateTime      @default(now()) @db.DateTime(0)
  dFechaUltimaActividad DateTime      @default(now()) @db.DateTime(0)
  dFechaExpiracion      DateTime      @db.DateTime(0)
  sIpUsuario            String?       @db.VarChar(50)
  sUserAgent            String?       @db.Text
  sDispositivo          String?       @db.VarChar(100)
  bActiva               Boolean       @default(true)
  usuario               BP_01_USUARIO @relation("UsuarioSesiones", fields: [nId01Usuario], references: [nId01Usuario], onDelete: NoAction, onUpdate: NoAction, map: "BP_08_SESION_ACTIVA_ibfk_1")

  @@index([nId01Usuario], map: "idx_sesion_usuario")
  @@index([sTokenSesion], map: "idx_sesion_token")
  @@index([bActiva], map: "idx_sesion_activa")
  @@index([dFechaExpiracion], map: "idx_sesion_expiracion")
  @@map("bp_08_sesion_activa")
}

model auditlog {
  id        Int       @id @default(autoincrement())
  userId    Int?
  username  String?   @db.VarChar(255)
  event     String    @db.VarChar(255)
  ip        String?   @db.VarChar(255)
  timestamp DateTime? @default(now()) @db.DateTime(0)
  details   String?   @db.Text
}
