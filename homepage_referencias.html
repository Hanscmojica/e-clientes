<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homepage - Referencias</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide-static@latest/dist/lucide.min.js"></script>
    <style>
        /* Fuente personalizada */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f9fafb; }
        /* Estilo para asegurar que el footer se quede abajo */
        .site-container { display: flex; flex-direction: column; min-height: 100vh; }
        .site-content { flex-grow: 1; }
        /* Iconos */
        .icon { display: inline-block; width: 1em; height: 1em; stroke-width: 2; vertical-align: middle; margin-right: 0.25em; }
        .icon-sm { width: 0.9em; height: 0.9em; margin-right: 0.2em;}
        .icon-lg { width: 1.2em; height: 1.2em; margin-right: 0.4em;}
        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 50; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { background-color: white; padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); max-width: 90%; width: 600px; position: relative; transform: scale(0.95); transition: transform 0.3s ease; max-height: 90vh; overflow-y: auto; display: flex; flex-direction: column; }
        .modal-overlay.active .modal-content { transform: scale(1); }
        .modal-close-button { position: absolute; top: 0.75rem; right: 0.75rem; background: none; border: none; cursor: pointer; color: #6b7280; }
        .modal-close-button:hover { color: #1f2937; }
        .modal-close-button .icon { width: 1.5rem; height: 1.5rem; }
        /* Navegación */
        .nav-link-active { border-bottom-width: 2px; border-color: #6366f1; color: #1f2937; }
        .nav-link-inactive { border-bottom-width: 2px; border-color: transparent; color: #6b7280; }
        .nav-link-inactive:hover { border-color: #d1d5db; color: #374151; }
        .mobile-nav-link-active { background-color: #eef2ff; border-color: #6366f1; color: #4338ca; border-left-width: 4px; }
        .mobile-nav-link-inactive { border-color: transparent; color: #4b5563; border-left-width: 4px; }
        .mobile-nav-link-inactive:hover { background-color: #f9fafb; border-color: #d1d5db; color: #1f2937; }
        /* Estados */
        .status-liberado { color: #16a34a; } .status-en-proceso { color: #ca8a04; } .status-en-transito { color: #2563eb; } .status-pendiente-aduana { color: #d97706; }
        /* Filtros y Búsqueda */
        .filter-pill { display: inline-flex; align-items: center; padding: 0.5rem 1rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500; transition: all 0.2s ease; cursor: pointer; border: 1px solid transparent; }
        .filter-pill.active { border-color: currentColor; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06); }
        .filter-pill-todos { background-color: #e0e7ff; color: #4338ca; } .filter-pill-todos:hover:not(.active) { background-color: #c7d2fe; }
        .filter-pill-liberado { background-color: #d1fae5; color: #065f46; } .filter-pill-liberado:hover:not(.active) { background-color: #a7f3d0; }
        .filter-pill-proceso { background-color: #fef3c7; color: #92400e; } .filter-pill-proceso:hover:not(.active) { background-color: #fde68a; }
        .filter-pill-transito { background-color: #dbeafe; color: #1e40af; } .filter-pill-transito:hover:not(.active) { background-color: #bfdbfe; }
        .filter-pill-aduana { background-color: #ffedd5; color: #c2410c; } .filter-pill-aduana:hover:not(.active) { background-color: #fed7aa; }
        .search-container { position: relative; } .search-icon { position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: #9ca3af; } .search-input { padding-left: 2.5rem; }
        /* Tarjetas */
        .reference-card { transition: all 0.2s ease-in-out; border: 1px solid #e5e7eb; }
        .reference-card:hover { transform: translateY(-3px); border-color: #c7d2fe; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.04); }
        /* Botones */
        .btn-transition { transition: all 0.2s ease-in-out; } .btn-transition:hover { transform: scale(1.05); }
        .modal-doc-list { margin-top: 1.5rem; border-top: 1px solid #e5e7eb; padding-top: 1rem; max-height: 300px; overflow-y: auto; }
        .modal-doc-item { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #f3f4f6; }
        .modal-doc-item:last-child { border-bottom: none; }
        .modal-doc-info { display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; }
        .modal-doc-actions button { padding: 0.25rem 0.5rem; font-size: 0.75rem; }
        .modal-doc-actions .icon-sm { width: 0.9em; height: 0.9em; margin-right: 0.2em;}
    </style>
</head>
<body class="bg-gray-100">
<div class="site-container">

    <nav class="bg-white shadow-md">
         <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between h-16"><div class="flex"><div class="flex-shrink-0 flex items-center text-xl font-bold text-indigo-600">E-CLIENTES</div><div class="hidden sm:ml-6 sm:flex sm:space-x-8"><a href="homepage_referencias.html" class="nav-link-active inline-flex items-center px-1 pt-1 text-sm font-medium" aria-current="page">Referencias</a><a href="#" class="nav-link-inactive inline-flex items-center px-1 pt-1 text-sm font-medium">Dashboard</a><a href="biblioteca.html" class="nav-link-inactive inline-flex items-center px-1 pt-1 text-sm font-medium">Biblioteca</a><a href="historial.html" class="nav-link-inactive inline-flex items-center px-1 pt-1 text-sm font-medium">Historial</a><a href="#" class="nav-link-inactive inline-flex items-center px-1 pt-1 text-sm font-medium">Perfil</a></div></div><div class="hidden sm:ml-6 sm:flex sm:items-center"><button type="button" onclick="logout()" class="ml-3 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 btn-transition"><i data-lucide="log-out" class="icon"></i>Salir</button></div><div class="-mr-2 flex items-center sm:hidden"><button type="button" id="mobileMenuButton" class="bg-white inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" aria-controls="mobile-menu" aria-expanded="false"><span class="sr-only">Abrir menú principal</span><svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg><svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div></div></div><div class="hidden sm:hidden" id="mobile-menu"><div class="pt-2 pb-3 space-y-1"><a href="homepage_referencias.html" class="mobile-nav-link-active block pl-3 pr-4 py-2 text-base font-medium" aria-current="page">Referencias</a><a href="#" class="mobile-nav-link-inactive block pl-3 pr-4 py-2 text-base font-medium">Dashboard</a><a href="biblioteca.html" class="mobile-nav-link-inactive block pl-3 pr-4 py-2 text-base font-medium">Biblioteca</a><a href="historial.html" class="mobile-nav-link-inactive block pl-3 pr-4 py-2 text-base font-medium">Historial</a><a href="#" class="mobile-nav-link-inactive block pl-3 pr-4 py-2 text-base font-medium">Perfil</a><a href="#" onclick="logout()" class="border-transparent text-red-600 hover:bg-red-50 hover:border-red-300 hover:text-red-800 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">Salir</a></div></div>
    </nav>

    <main class="site-content max-w-7xl w-full mx-auto py-6 sm:px-6 lg:px-8">
        <div class="px-4 py-6 sm:px-0">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
                <h1 class="text-3xl font-bold text-gray-900 mb-4 md:mb-0">Mis Referencias</h1>
                <div class="flex flex-col sm:flex-row gap-4">
                    <div class="search-container w-full sm:w-64">
                        <i data-lucide="search" class="search-icon w-5 h-5"></i>
                        <input type="text" id="searchInput" placeholder="Buscar referencia..." class="search-input w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
                <div class="flex flex-wrap gap-2">
                    <button class="filter-pill filter-pill-todos active" data-filter="todos">Todos</button>
                    <button class="filter-pill filter-pill-liberado" data-filter="Liberado">Liberado</button>
                    <button class="filter-pill filter-pill-proceso" data-filter="En Proceso">En Proceso</button>
                    <button class="filter-pill filter-pill-transito" data-filter="En Tránsito">En Tránsito</button>
                    <button class="filter-pill filter-pill-aduana" data-filter="Pendiente Aduana">Pendiente Aduana</button>
                </div>
            </div>

            <div id="referencesContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">

                 <div class="bg-white overflow-hidden shadow rounded-lg p-5 flex flex-col justify-between reference-card" data-ref-id="REF12345" data-estado="Liberado"><div><h3 class="text-lg leading-6 font-medium text-indigo-600">Referencia #REF12345</h3><p class="mt-1 max-w-2xl text-sm text-gray-500 truncate">Contenedor: MSCU1234567</p><p class="mt-1 text-sm text-gray-500">Fecha: 03/05/2025</p><p class="mt-1 text-sm text-gray-500">Estado: <span class="font-medium status-liberado">Liberado</span></p></div><div class="mt-4 flex flex-wrap gap-2 justify-start"><button onclick="downloadPdf('REF12345/Referencia_REF12345.pdf')" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs leading-4 font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 btn-transition"><i data-lucide="download" class="icon"></i>PDF</button><button onclick="openPreviewModal({ id: 'REF12345', contenedor: 'MSCU1234567', fecha: '03/05/2025', estado: 'Liberado', origen: 'Shanghai, China', destino: 'Veracruz, México', tipoCarga: 'General', peso: '22 Toneladas', bl: 'MSCUXYZ789' })" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 btn-transition"><i data-lucide="eye" class="icon"></i>Vista Previa</button></div></div>

                <div class="bg-white overflow-hidden shadow rounded-lg p-5 flex flex-col justify-between reference-card" data-ref-id="REF67890" data-estado="En Proceso"><div><h3 class="text-lg leading-6 font-medium text-indigo-600">Referencia #REF67890</h3><p class="mt-1 max-w-2xl text-sm text-gray-500 truncate">Contenedor: CMAU7654321</p><p class="mt-1 text-sm text-gray-500">Fecha: 02/05/2025</p><p class="mt-1 text-sm text-gray-500">Estado: <span class="font-medium status-en-proceso">En Proceso</span></p></div><div class="mt-4 flex flex-wrap gap-2 justify-start"><button onclick="downloadPdf('REF67890/Referencia_REF67890.pdf')" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs leading-4 font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 btn-transition"><i data-lucide="download" class="icon"></i>PDF</button><button onclick="openPreviewModal({ id: 'REF67890', contenedor: 'CMAU7654321', fecha: '02/05/2025', estado: 'En Proceso', origen: 'Rotterdam, Países Bajos', destino: 'Veracruz, México', tipoCarga: 'Refrigerada', peso: '18 Toneladas', bl: 'CMAUVWX456' })" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 btn-transition"><i data-lucide="eye" class="icon"></i>Vista Previa</button></div></div>

                <div class="bg-white overflow-hidden shadow rounded-lg p-5 flex flex-col justify-between reference-card" data-ref-id="REF11223" data-estado="Liberado"><div><h3 class="text-lg leading-6 font-medium text-indigo-600">Referencia #REF11223</h3><p class="mt-1 max-w-2xl text-sm text-gray-500 truncate">Contenedor: HLCU9876543</p><p class="mt-1 text-sm text-gray-500">Fecha: 01/05/2025</p><p class="mt-1 text-sm text-gray-500">Estado: <span class="font-medium status-liberado">Liberado</span></p></div><div class="mt-4 flex flex-wrap gap-2 justify-start"><button onclick="downloadPdf('REF11223/Referencia_REF11223.pdf')" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs leading-4 font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 btn-transition"><i data-lucide="download" class="icon"></i>PDF</button><button onclick="openPreviewModal({ id: 'REF11223', contenedor: 'HLCU9876543', fecha: '01/05/2025', estado: 'Liberado', origen: 'Hamburg, Alemania', destino: 'Veracruz, México', tipoCarga: 'Peligrosa (IMO)', peso: '15 Toneladas', bl: 'HLCURST123' })" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 btn-transition"><i data-lucide="eye" class="icon"></i>Vista Previa</button></div></div>

                <div class="bg-white overflow-hidden shadow rounded-lg p-5 flex flex-col justify-between reference-card" data-ref-id="REF44556" data-estado="En Tránsito"><div><h3 class="text-lg leading-6 font-medium text-indigo-600">Referencia #REF44556</h3><p class="mt-1 max-w-2xl text-sm text-gray-500 truncate">Contenedor: APLU1122334</p><p class="mt-1 text-sm text-gray-500">Fecha: 10/05/2025</p><p class="mt-1 text-sm text-gray-500">Estado: <span class="font-medium status-en-transito">En Tránsito</span></p></div><div class="mt-4 flex flex-wrap gap-2 justify-start"><button onclick="downloadPdf('REF44556/Referencia_REF44556.pdf')" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs leading-4 font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 btn-transition"><i data-lucide="download" class="icon"></i>PDF</button><button onclick="openPreviewModal({ id: 'REF44556', contenedor: 'APLU1122334', fecha: '10/05/2025', estado: 'En Tránsito', origen: 'Manzanillo, México', destino: 'Long Beach, USA', tipoCarga: 'Automotriz', peso: '19 Toneladas', bl: 'APLUABC123' })" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 btn-transition"><i data-lucide="eye" class="icon"></i>Vista Previa</button></div></div>

                <div class="bg-white overflow-hidden shadow rounded-lg p-5 flex flex-col justify-between reference-card" data-ref-id="REF77889" data-estado="Pendiente Aduana"><div><h3 class="text-lg leading-6 font-medium text-indigo-600">Referencia #REF77889</h3><p class="mt-1 max-w-2xl text-sm text-gray-500 truncate">Contenedor: ZIMU5566778</p><p class="mt-1 text-sm text-gray-500">Fecha: 11/05/2025</p><p class="mt-1 text-sm text-gray-500">Estado: <span class="font-medium status-pendiente-aduana">Pendiente Aduana</span></p></div><div class="mt-4 flex flex-wrap gap-2 justify-start"><button onclick="downloadPdf('REF77889/Referencia_REF77889.pdf')" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs leading-4 font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 btn-transition"><i data-lucide="download" class="icon"></i>PDF</button><button onclick="openPreviewModal({ id: 'REF77889', contenedor: 'ZIMU5566778', fecha: '11/05/2025', estado: 'Pendiente Aduana', origen: 'Valencia, España', destino: 'Veracruz, México', tipoCarga: 'Textil', peso: '12 Toneladas', bl: 'ZIMUDEFG456' })" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 btn-transition"><i data-lucide="eye" class="icon"></i>Vista Previa</button></div></div>

                <div class="bg-white overflow-hidden shadow rounded-lg p-5 flex flex-col justify-between reference-card" data-ref-id="REF99001" data-estado="Liberado"><div><h3 class="text-lg leading-6 font-medium text-indigo-600">Referencia #REF99001</h3><p class="mt-1 max-w-2xl text-sm text-gray-500 truncate">Contenedor: ONEY1212121</p><p class="mt-1 text-sm text-gray-500">Fecha: 12/05/2025</p><p class="mt-1 text-sm text-gray-500">Estado: <span class="font-medium status-liberado">Liberado</span></p></div><div class="mt-4 flex flex-wrap gap-2 justify-start"><button onclick="downloadPdf('REF99001/Referencia_REF99001.pdf')" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs leading-4 font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 btn-transition"><i data-lucide="download" class="icon"></i>PDF</button><button onclick="openPreviewModal({ id: 'REF99001', contenedor: 'ONEY1212121', fecha: '12/05/2025', estado: 'Liberado', origen: 'Santos, Brasil', destino: 'Altamira, México', tipoCarga: 'Químicos', peso: '21 Toneladas', bl: 'ONEYHIJ789' })" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 btn-transition"><i data-lucide="eye" class="icon"></i>Vista Previa</button></div></div>

                <div class="bg-white overflow-hidden shadow rounded-lg p-5 flex flex-col justify-between reference-card" data-ref-id="REF23234" data-estado="En Proceso"><div><h3 class="text-lg leading-6 font-medium text-indigo-600">Referencia #REF23234</h3><p class="mt-1 max-w-2xl text-sm text-gray-500 truncate">Contenedor: EVGU3434343</p><p class="mt-1 text-sm text-gray-500">Fecha: 13/05/2025</p><p class="mt-1 text-sm text-gray-500">Estado: <span class="font-medium status-en-proceso">En Proceso</span></p></div><div class="mt-4 flex flex-wrap gap-2 justify-start"><button onclick="downloadPdf('REF23234/Referencia_REF23234.pdf')" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs leading-4 font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 btn-transition"><i data-lucide="download" class="icon"></i>PDF</button><button onclick="openPreviewModal({ id: 'REF23234', contenedor: 'EVGU3434343', fecha: '13/05/2025', estado: 'En Proceso', origen: 'Hong Kong, China', destino: 'Ensenada, México', tipoCarga: 'Electrónicos', peso: '16 Toneladas', bl: 'EVGUKLM012' })" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 btn-transition"><i data-lucide="eye" class="icon"></i>Vista Previa</button></div></div>

                <div class="bg-white overflow-hidden shadow rounded-lg p-5 flex flex-col justify-between reference-card" data-ref-id="REF54546" data-estado="Liberado"><div><h3 class="text-lg leading-6 font-medium text-indigo-600">Referencia #REF54546</h3><p class="mt-1 max-w-2xl text-sm text-gray-500 truncate">Contenedor: COSU7878787</p><p class="mt-1 text-sm text-gray-500">Fecha: 14/05/2025</p><p class="mt-1 text-sm text-gray-500">Estado: <span class="font-medium status-liberado">Liberado</span></p></div><div class="mt-4 flex flex-wrap gap-2 justify-start"><button onclick="downloadPdf('REF54546/Referencia_REF54546.pdf')" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs leading-4 font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 btn-transition"><i data-lucide="download" class="icon"></i>PDF</button><button onclick="openPreviewModal({ id: 'REF54546', contenedor: 'COSU7878787', fecha: '14/05/2025', estado: 'Liberado', origen: 'Callao, Perú', destino: 'Veracruz, México', tipoCarga: 'Alimentos', peso: '20 Toneladas', bl: 'COSUNOP345' })" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 btn-transition"><i data-lucide="eye" class="icon"></i>Vista Previa</button></div></div>

                <div class="bg-white overflow-hidden shadow rounded-lg p-5 flex flex-col justify-between reference-card" data-ref-id="REF87879" data-estado="En Tránsito"><div><h3 class="text-lg leading-6 font-medium text-indigo-600">Referencia #REF87879</h3><p class="mt-1 max-w-2xl text-sm text-gray-500 truncate">Contenedor: MAEU2121212</p><p class="mt-1 text-sm text-gray-500">Fecha: 15/05/2025</p><p class="mt-1 text-sm text-gray-500">Estado: <span class="font-medium status-en-transito">En Tránsito</span></p></div><div class="mt-4 flex flex-wrap gap-2 justify-start"><button onclick="downloadPdf('REF87879/Referencia_REF87879.pdf')" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs leading-4 font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 btn-transition"><i data-lucide="download" class="icon"></i>PDF</button><button onclick="openPreviewModal({ id: 'REF87879', contenedor: 'MAEU2121212', fecha: '15/05/2025', estado: 'En Tránsito', origen: 'Bremerhaven, Alemania', destino: 'Veracruz, México', tipoCarga: 'Maquinaria', peso: '23 Toneladas', bl: 'MAEUQRS678' })" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 btn-transition"><i data-lucide="eye" class="icon"></i>Vista Previa</button></div></div>

                <div class="bg-white overflow-hidden shadow rounded-lg p-5 flex flex-col justify-between reference-card" data-ref-id="REF01012" data-estado="Pendiente Aduana"><div><h3 class="text-lg leading-6 font-medium text-indigo-600">Referencia #REF01012</h3><p class="mt-1 max-w-2xl text-sm text-gray-500 truncate">Contenedor: HMMU9090909</p><p class="mt-1 text-sm text-gray-500">Fecha: 16/05/2025</p><p class="mt-1 text-sm text-gray-500">Estado: <span class="font-medium status-pendiente-aduana">Pendiente Aduana</span></p></div><div class="mt-4 flex flex-wrap gap-2 justify-start"><button onclick="downloadPdf('REF01012/Referencia_REF01012.pdf')" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs leading-4 font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 btn-transition"><i data-lucide="download" class="icon"></i>PDF</button><button onclick="openPreviewModal({ id: 'REF01012', contenedor: 'HMMU9090909', fecha: '16/05/2025', estado: 'Pendiente Aduana', origen: 'Busan, Corea del Sur', destino: 'Manzanillo, México', tipoCarga: 'Muebles', peso: '17 Toneladas', bl: 'HMMUTUV901' })" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 btn-transition"><i data-lucide="eye" class="icon"></i>Vista Previa</button></div></div>

                

            </div> </div>
    </main>

    <footer class="bg-white mt-8 shadow-inner">
        <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-gray-500 text-sm">
            &copy; 2025 Agencia Aduanal Rodall Oseguera. Todos los derechos reservados.
        </div>
    </footer>

</div>

<div id="previewModal" class="modal-overlay">
    <div class="modal-content">
        <button onclick="closePreviewModal()" class="modal-close-button" aria-label="Cerrar">
             <i data-lucide="x" class="icon"></i>
        </button>
        <h3 class="text-xl font-semibold text-gray-900 mb-4" id="modalTitle">Detalles de la Referencia</h3>
        <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm text-gray-700 mb-4">
            <p><strong>ID Referencia:</strong> <span id="modalRefId"></span></p>
            <p><strong>Contenedor:</strong> <span id="modalContenedor"></span></p>
            <p><strong>Fecha:</strong> <span id="modalFecha"></span></p>
            <p><strong>Estado:</strong> <span id="modalEstado" class="font-medium"></span></p>
            <p><strong>Origen:</strong> <span id="modalOrigen"></span></p>
            <p><strong>Destino:</strong> <span id="modalDestino"></span></p>
            <p><strong>Tipo Carga:</strong> <span id="modalTipoCarga"></span></p>
            <p><strong>Peso:</strong> <span id="modalPeso"></span></p>
            <p class="col-span-2"><strong>BL:</strong> <span id="modalBl"></span></p>
        </div>

        <h4 class="text-lg font-semibold text-gray-800 border-t pt-4 mt-4 mb-2">Documentos Asociados</h4>
        <div id="modalDocList" class="modal-doc-list">
            <p class="text-center text-gray-500 text-sm py-4">Cargando documentos...</p>
        </div>
    </div>
</div>

<script>
    // --- Backend URL ---
    const BACKEND_URL = 'http://localhost:5001';

    // --- Constantes Globales ---
    const modalOverlay = document.getElementById('previewModal');
    const searchInput = document.getElementById('searchInput');
    const filterPills = document.querySelectorAll('.filter-pill');
    const referencesContainer = document.getElementById('referencesContainer');

    // Estado actual del filtro
    let currentFilter = 'todos';

    // --- Función para Descarga de PDF ---
    function downloadPdf(filePath) {
        console.log(`Intentando descargar: ${filePath}`);
        const downloadUrl = `${BACKEND_URL}/download/${encodeURIComponent(filePath)}`;
        console.log(`URL de descarga: ${downloadUrl}`);
        try {
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            console.log(`Petición de descarga para ${filePath} enviada.`);
        } catch (error) {
            console.error(`Error al intentar iniciar descarga para ${filePath}:`, error);
            alert(`Error al iniciar la descarga. Revisa la consola.`);
        }
    }

    // --- Función para Vista Previa ---
    function triggerPreview(filePath, filetype) {
        console.log(`Intentando vista previa para: ${filePath}, Tipo: ${filetype}`);
        const previewableTypes = ['PDF', 'Imagen', 'Texto'];
        if (previewableTypes.includes(filetype)) {
            const viewUrl = `${BACKEND_URL}/view/${encodeURIComponent(filePath)}`;
            console.log(`Abriendo URL de vista previa: ${viewUrl}`);
            window.open(viewUrl, '_blank');
        } else {
            alert(`La vista previa no está disponible para archivos de tipo: ${filetype}. Intenta descargarlo.`);
            console.log(`Vista previa no soportada para tipo: ${filetype}`);
        }
    }

    // --- Funciones para el Modal ---
    async function openPreviewModal(data) {
        console.log("Abriendo modal para referencia:", data.id);
        if (!modalOverlay) {
            console.error("Modal no encontrado.");
            return;
        }
        
        // Extraer solo el ID de referencia sin "#" si existe
        const referenceId = data.id.startsWith('#') ? data.id.substring(1) : data.id;
        
        try {
            // Poblar detalles básicos
            document.getElementById('modalTitle').textContent = `Detalles de la Referencia #${referenceId}`;
            document.getElementById('modalRefId').textContent = `#${referenceId}`;
            document.getElementById('modalContenedor').textContent = data.contenedor;
            document.getElementById('modalFecha').textContent = data.fecha;
            document.getElementById('modalEstado').textContent = data.estado;
            document.getElementById('modalOrigen').textContent = data.origen;
            document.getElementById('modalDestino').textContent = data.destino;
            document.getElementById('modalTipoCarga').textContent = data.tipoCarga;
            document.getElementById('modalPeso').textContent = data.peso;
            document.getElementById('modalBl').textContent = data.bl;
            
            // Configurar el estilo del estado
            const estadoSpan = document.getElementById('modalEstado');
            estadoSpan.className = 'font-medium';
            const estadoClass = `status-${data.estado.toLowerCase().replace(/[^a-z0-9]/g, '-')}`;
            if (document.querySelector(`style`)?.sheet?.cssRules) {
                let styleExists = false;
                const styles = document.querySelector(`style`).sheet.cssRules;
                for(let i=0; i<styles.length; i++){
                    if(styles[i].selectorText === `.${estadoClass}`) {
                        styleExists = true;
                        break;
                    }
                }
                if (styleExists) estadoSpan.classList.add(estadoClass);
                else estadoSpan.classList.add('text-gray-600');
            } else {
                estadoSpan.classList.add('text-gray-600');
            }

            // Mostrar modal con mensaje de carga para docs
            const docListContainer = document.getElementById('modalDocList');
            if(docListContainer) docListContainer.innerHTML = '<p class="text-center text-gray-500 text-sm py-4">Cargando documentos...</p>';
            modalOverlay.classList.add('active');
            renderIcons(modalOverlay);

            // Obtener documentos asociados (usando la nueva ruta con subdirectorio)
            console.log(`Obteniendo documentos para: /list/${referenceId}`);
            const response = await fetch(`${BACKEND_URL}/list/${referenceId}`);
            
            if (!response.ok) {
                let errorMsg = `Error ${response.status}: ${response.statusText}`;
                try {
                    const errorData = await response.json();
                    errorMsg = `Error del backend: ${errorData.error || errorMsg}`;
                } catch(e){}
                
                // Especialmente manejar 404 (directorio no encontrado)
                if (response.status === 404) {
                    errorMsg = "No se encontró la carpeta de documentos para esta referencia en el servidor.";
                }
                throw new Error(errorMsg);
            }
            
            const documents = await response.json();
            console.log(`Documentos recibidos para ${referenceId}:`, documents);

            // Renderizar lista
            renderModalDocList(docListContainer, documents, referenceId);

        } catch (error) {
            console.error("Error al abrir modal o cargar documentos:", error);
            const docListContainer = document.getElementById('modalDocList');
            if(docListContainer) {
                docListContainer.innerHTML = `<p class="text-center text-red-600 text-sm py-4">Error al cargar documentos: ${error.message}</p>`;
            }
            if (!modalOverlay.classList.contains('active')) {
                modalOverlay.classList.add('active');
                renderIcons(modalOverlay);
            }
        }
    }

    function renderModalDocList(container, documents, referenceId) {
        if (!container) return;
        container.innerHTML = '';

        if (!documents || documents.length === 0) {
            container.innerHTML = '<p class="text-center text-gray-500 text-sm py-4">No se encontraron documentos asociados.</p>';
            return;
        }

        documents.forEach(doc => {
            if (doc.isDir) return; // Omitir directorios

            const listItem = document.createElement('div');
            listItem.className = 'modal-doc-item';
            const safeFilename = doc.filename || doc.title;
            const escapedFilename = safeFilename.replace(/'/g, "\\'");
            const docType = doc.type || 'Archivo';
            
            // Construir la ruta relativa completa para las acciones
            const relativePath = `${referenceId}/${safeFilename}`;
            const escapedRelativePath = relativePath.replace(/'/g, "\\'");
            const itemIcon = `<i data-lucide="${getIconForType(docType)}" class="icon-sm text-gray-500"></i>`;

            listItem.innerHTML = `
                <div class="modal-doc-info">
                    ${itemIcon}
                    <span class="text-gray-800 font-medium">${doc.title || 'Sin título'}</span>
                    <span class="text-gray-400">(${doc.size || 'N/A'})</span>
                </div>
                <div class="modal-doc-actions space-x-2">
                    <button onclick="downloadPdf('${escapedRelativePath}')" class="text-green-600 hover:text-green-800 p-1 text-xs" title="Descargar">
                        <i data-lucide="download" class="icon-sm"></i> Descargar
                    </button>
                    <button onclick="triggerPreview('${escapedRelativePath}', '${docType}')" class="text-indigo-600 hover:text-indigo-800 p-1 text-xs" title="Vista Previa">
                        <i data-lucide="eye" class="icon-sm"></i> Ver
                    </button>
                </div>
            `;
            container.appendChild(listItem);
        });

        renderIcons(container);
    }

    function getIconForType(docType) {
        switch (docType) {
            case 'PDF': return 'file-type-pdf';
            case 'Imagen': return 'image';
            case 'Texto': return 'file-text';
            case 'Word': return 'file-type-word';
            case 'Excel': return 'file-spreadsheet';
            case 'Comprimido': return 'file-archive';
            case 'Carpeta': return 'folder';
            default: return 'file';
        }
    }

    function closePreviewModal() {
        if (modalOverlay) {
            modalOverlay.classList.remove('active');
        } else {
            console.error("Modal no encontrado al cerrar.");
        }
    }

    // --- Función para filtrar las referencias ---
    function filterReferences() {
        const searchTerm = searchInput.value.toLowerCase();
        const referenceCards = referencesContainer.querySelectorAll('.reference-card');
        referenceCards.forEach(card => {
            const refId = (card.getAttribute('data-ref-id') || '').toLowerCase();
            const estado = card.getAttribute('data-estado');
            const contenedorElement = card.querySelector('p:nth-of-type(1)');
            const contenedor = contenedorElement ? contenedorElement.textContent.toLowerCase().split(': ')[1] || '' : '';
            const matchesSearch = searchTerm === '' || refId.includes(searchTerm) || contenedor.includes(searchTerm);
            const matchesFilter = currentFilter === 'todos' || estado === currentFilter;
            card.style.display = (matchesSearch && matchesFilter) ? '' : 'none';
        });
    }

    // --- Función para renderizar iconos ---
    function renderIcons(context = document) {
        if (typeof lucide !== 'undefined' && lucide && typeof lucide.createIcons === 'function') {
            try {
                lucide.createIcons({ context });
            } catch (error) {
                console.error("Error al renderizar iconos Lucide:", error);
            }
        } else {
            if (!window.lucideCheckFailed) {
                console.warn("Lucide no definido.");
                window.lucideCheckFailed = true;
            }
        }
    }

    // --- Event Listeners ---
    if (modalOverlay) {
        modalOverlay.addEventListener('click', (event) => {
            if (event.target === modalOverlay) {
                closePreviewModal();
            }
        });
    } else {
        console.warn("Listener no añadido: modalOverlay no encontrado.");
    }

    document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && modalOverlay?.classList.contains('active')) {
            closePreviewModal();
        }
    });

    filterPills.forEach(pill => {
        pill.addEventListener('click', function() {
            filterPills.forEach(p => p.classList.remove('active'));
            this.classList.add('active');
            currentFilter = this.getAttribute('data-filter');
            filterReferences();
        });
    });

    if (searchInput) {
        searchInput.addEventListener('input', filterReferences);
    } else {
        console.warn("Listener no añadido: searchInput no encontrado.");
    }

    const menuButton = document.getElementById('mobileMenuButton');
    const mobileMenu = document.getElementById('mobile-menu');
    if (menuButton && mobileMenu) {
        const openIcon = menuButton.querySelector('svg:not(.hidden)');
        const closeIcon = menuButton.querySelector('svg.hidden');
        if (openIcon && closeIcon) {
            menuButton.addEventListener('click', () => {
                const isExpanded = menuButton.getAttribute('aria-expanded') === 'true';
                menuButton.setAttribute('aria-expanded', !isExpanded);
                mobileMenu.classList.toggle('hidden');
                openIcon.classList.toggle('hidden');
                openIcon.classList.toggle('block');
                closeIcon.classList.toggle('hidden');
                closeIcon.classList.toggle('block');
            });
        } else {
            console.warn("Iconos de menú móvil no encontrados.");
        }
    } else {
        console.warn("Elementos menú móvil no encontrados.");
    }

    // --- Inicialización ---
    document.addEventListener('DOMContentLoaded', (event) => {
        console.log("Homepage Referencias - DOM cargado.");
        renderIcons(); // Renderizar iconos iniciales
        filterReferences(); // Aplicar filtro inicial
    });

    // --- Función Logout ---
    function logout() {
        console.log("Cerrando sesión...");
        alert("Cerrando sesión... Volviendo a la página de login.");
        window.location.href = 'login_form_moderno.html';
    }
</script>

</body>
</html>